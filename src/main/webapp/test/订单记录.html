<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>我的订单-广东邮电大厦</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="author" content="www.hs.com">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="http://14.146.224.119/m/themes/default/common/wap.css">
    <script type="text/javascript" src="./我的订单-广东邮电大厦_files/globalVar.js"></script>
    <script type="text/javascript" src="./我的订单-广东邮电大厦_files/jquery-1.7.1.min.js"></script>
    <script type="text/javascript">
        var $j = jQuery.noConflict();
        $j.ajaxSetup({
            cache: false,
            success: function (data, textStatus) {

                if (data != null && data != undefined && data.indexOf("j_username") != -1 && data.indexOf("j_password") != -1 && data.indexOf("isLoginPage") != -1) {
                    window.location = __ctxPath + "/login.html";
                }
            }
        });

        $j.fn.extend({
            loading: function () {
                return this.each(function () {
                    $j(this).css({"position": "relative"}).append('<div class="loading_data">&nbsp;</div>');
                });
            }
        });

    </script>

</head>
<body>
<div data-role="page">


<div class="carte my_carte">
<div class="box_carte">
<div id="shippingcartBillDiv" class="tips">
    <span class="fl">您共点了8道菜</span>
        <span class="fr">共计：<strong class="red">303.00元</strong><font
                style="font-size: 10pt; color: #999999">(不含时价菜)</font></span></div>

<div id="contentRt" class="content index_other" style="height: 783px;">
    <div class="title">
        <h4 class="fl">我的订单</h4>

        <div class="fr">
            <a class="btn_green" onclick="goIndex()">加菜</a>
            <a class="btn_cle6e6e8" id="show" href="javascript:void(0)" onclick="clearCart();">清空</a>
        </div>
        <div class="clear"></div>
    </div>
    <ul class="">
        <li>
            <div class="cont_fl">
                <div class="txt">
                    <h3><a href="./我的订单-广东邮电大厦_files/我的订单-广东邮电大厦.html">客家小盆菜</a></h3>

                    <p class="cl666"><span class="red">48.0元/
										例</span>
                    </p>
                </div>
            </div>
            <div class="cont_fr cont_fr_other">
                <a class="btn_subtract" href="javascript:void(0)" onclick="quantityMinus(&#39;00182&#39;, 1);"></a>
                <span id="00182" name="quantitys" tabindex="1">5</span>
                <a class="btn_add" href="javascript:void(0)" onclick="quantityPlus(&#39;00182&#39;, 1);"></a>
                <input type="hidden" name="productSkuCodes" value="00182">
            </div>
        </li>
        <li>
            <div class="cont_fl">
                <div class="txt">
                    <h3><a href="./我的订单-广东邮电大厦_files/我的订单-广东邮电大厦.html">连州腊味糯米鸡</a></h3>

                    <p class="cl666"><span class="red">20.0元/
										笼</span>
                    </p>
                </div>
            </div>
            <div class="cont_fr cont_fr_other">
                <a class="btn_subtract" href="javascript:void(0)" onclick="quantityMinus(&#39;00395&#39;, 2);"></a>
                <span id="00395" name="quantitys" tabindex="2">1</span>
                <a class="btn_add" href="javascript:void(0)" onclick="quantityPlus(&#39;00395&#39;, 2);"></a>
                <input type="hidden" name="productSkuCodes" value="00395">
            </div>
        </li>
        <li>
            <div class="cont_fl">
                <div class="txt">
                    <h3><a href="./我的订单-广东邮电大厦_files/我的订单-广东邮电大厦.html">金牌榴莲酥 </a></h3>

                    <p class="cl666"><span class="red">13.0元/
										碟</span>
                    </p>
                </div>
            </div>
            <div class="cont_fr cont_fr_other">
                <a class="btn_subtract" href="javascript:void(0)" onclick="quantityMinus(&#39;00420&#39;, 3);"></a>
                <span id="00420" name="quantitys" tabindex="3">1</span>
                <a class="btn_add" href="javascript:void(0)" onclick="quantityPlus(&#39;00420&#39;, 3);"></a>
                <input type="hidden" name="productSkuCodes" value="00420">
            </div>
        </li>
        <li>
            <div class="cont_fl">
                <div class="txt">
                    <h3><a href="./我的订单-广东邮电大厦_files/我的订单-广东邮电大厦.html">飘香榴莲酥</a></h3>

                    <p class="cl666"><span class="red">30.0元/
										半打</span>
                    </p>
                </div>
            </div>
            <div class="cont_fr cont_fr_other">
                <a class="btn_subtract" href="javascript:void(0)" onclick="quantityMinus(&#39;00268&#39;, 4);"></a>
                <span id="00268" name="quantitys" tabindex="4">1</span>
                <a class="btn_add" href="javascript:void(0)" onclick="quantityPlus(&#39;00268&#39;, 4);"></a>
                <input type="hidden" name="productSkuCodes" value="00268">
            </div>
        </li>
    </ul>
    <p class="cl999 reference">菜式价格仅供参考，以餐厅结算为准！</p>

    <!-- 是否是vip -->
    <!-- 指定部长 begin  -->
    <!-- 堂食 -->
    <!-- -------- 指定部长 begin-------------->
    <div class="appoint">
        <input id="ministerId" type="hidden" value="">

        <div class="title2">
            <a href="javascript:void(0);" onclick="toggleScreen(this)" indexid="" objid="waiter">
                <em class="icn_appoint" id="img"></em>指定部长：
                <span id="spanTitle">不指定</span>
            </a>
        </div>
        <div class="minister" id="waiter" style="display: none;">
            <a href="javascript:void(0);" onclick="chooseMinister(this,&#39;&#39;)" value="" class="curr">不指定</a>
            <a href="javascript:void(0);" onclick="chooseMinister(this,&#39;0&#39;)"
               value="7dbe5c7f-93b5-488e-ba87-f07dc1043ccb">吴秋英</a>
            <a href="javascript:void(0);" onclick="chooseMinister(this,&#39;1&#39;)"
               value="e387d6c9-1aab-4878-a2cf-bc5605ff8a44">谢满香</a>
        </div>
        <div class="clear"></div>
    </div>
    <!-- -------- 指定部长 end-------------- -->

    <script type="text/javascript">
        var controller;
        $j(document).ready(function () {

        });

        //显示编辑页面
        function showEditPanel(moduleName, obj) {
            $j("#orderDetailSummaryPage").hide();	//隐藏主页
            if (moduleName == "consignee"
                    || moduleName == "virtualConsignee"
                    || moduleName == "paymentMethod"
                    || moduleName == "shippingMethod") {

                controller.edit(moduleName, obj);		//渲染编辑视图
            }
            $j("#" + moduleName + "Page").show();	//显示编辑视图
        }

        //显示主页,隐藏编辑页面
        function showMainPanel(moduleName) {
            $j("#" + moduleName + "Page").hide();	//隐藏编辑视图
            $j("#orderDetailSummaryPage").show();	//显示主页
        }

        function placeOrder(obj) {
            $j(obj).hide();	//隐藏按钮
            $j(".loading").show();

            var ministerId = $j("#ministerId").val();
            ministerData = {
                "ministerId": ministerId
            }
            DWREngine.setAsync(false);
            checkoutDwr.saveMinisterData(ministerData);

            //view.showWaitMessage(__FMT.checkout_loading, obj);
            setTimeout(function () {
                DWREngine.setAsync(true);					//设置ajax为异步解决ie下"loading"信息不显示问题
                checkoutDwr.placeOrder(
                        function (jsonText) {
                            var result = eval('(' + jsonText + ')');
                            if (result.error != null) {
                                alert(result.error);
                                data.error = result.error;
                            } else {
                                window.location = __ctxPath + "/cart/orderReview.html?doAction=checkoutSucc&orderNo=" + result.orderNo;
                            }
                        }
                );
            }, 50);
        }

        //显示 隐藏详细
        function toggleScreen(linkDOM) {
            var jTrThis = $j(linkDOM);
            var toggleButton = jTrThis.attr("objId");
            var jTrFull = $j("#" + toggleButton);
            var img = $j("#img");
            if (jTrFull.is(":hidden")) {
                img.removeClass("icn_appoint");
                img.addClass("icn_appoint_up");
                jTrFull.show();
            } else {
                jTrFull.hide();
                img.removeClass("icn_appoint_up");
                img.addClass("icn_appoint");
            }
        }

        //选择部长
        function chooseMinister(dom, index) {
            var dum = $j(dom);
            var classSpan = $j("#classSpan_" + index);
            var chooseValue = $j(dom).attr("value");
            $j("#ministerId").val(chooseValue);
            $j("#spanTitle").html(dum.text());
            var id = "waiter";
            var aDivs = document.getElementById(id);
            var aSpans = aDivs.getElementsByTagName("a");
            for (i = 0; i < aSpans.length; i++) {
                var aSpan = aSpans[i];
                aSpan.className = "";
            }
            //classSpan.addClass("on");
            $j(dom).addClass("curr");

        }
    </script>
    <!-- 指定部长 end  -->
</div>
</div>
<div class="clear"></div>
<div class="btn_my">
    <a id="goback" class="btn_my_green" href="http://14.146.224.119/m/index.html">返回菜单</a>
    <a id="goSalesOrder" class="btn_my_green" href="http://14.146.224.119/m/cart/shoppingcart.html#"
       onclick="goSalesOrder()">我的厨房</a>
    <a id="btnCheckout" href="javascript:void(0)" onclick="toCheckout();" class="btn_my_red">保存订单</a>
    <a class="loading btn_my_red" style="display:none;">准备保存订单，请稍等</a>

</div>
</div>


<script type="text/javascript">

function parseDate(dateStr) {
    if (dateStr.indexOf("PM") == -1) {
        return dateStr;
    }
    //2014-01-04 02:28 PM
    dateStr = dateStr.split(" ");
    var dayStr = dateStr[0];
    var timeStr = dateStr[1];
    timeStr = timeStr.split(":");
    timeStr[0] = parseInt(timeStr[0]) + 12;
    optime = dayStr + " " + timeStr[0] + ":" + timeStr[1];
    return optime;
}

//结帐按钮
function toCheckout() {
    if (ms_syouType == "2") {
        //是堂食才进行设置部长
        var ministerId = $j("#ministerId").val();
        var opamount = 0;
        var optime = "";
        var csnotes = "";
        ministerData = {
            "ministerId": ministerId
        }
        if (ms_isVip == 1) {
            //保存vip必须的信息
            if (!ministerId) {
                alert("请选择部长！");
                return;
            }
            opamount = $j("#opamount").val();
            optime = $j("#optime_y").val() + "-" + $j("#optime_MM").val() + "-" + $j("#optime_d").val() + " " + $j("#optime_h").val() + ":" + $j("#optime_m").val();
            csnotes = $j("#csnotes").val();

            var seltDate = new Date($j("#optime_y").val(), $j("#optime_MM").val(), $j("#optime_d").val());
            var nowDate = new Date();

            ministerData.opamount = opamount;
            ministerData.optime = optime;
            ministerData.csnotes = csnotes;
        }

        mask();
        $j("#btnCheckout").hide();	//隐藏按钮
        $j("#btnContinue").hide();
        //$j(".btn_my").hide();
        $j("#goSalesOrder").hide();
        $j("#goback").hide();
        $j("#sendOrder").hide();
        $j(".loading").show();

        DWREngine.setAsync(false);
        checkoutDwr.saveMinisterData(ministerData);
        if (!isCustomerBindCheck()) {
            //未绑定,跳转到绑定页面
            //window.location = __ctxPath+"/bindMoblie.html";
            dlgcustomerBindPanel_show();
            return;
        }
    } else if (ms_syouType == "3") {
        //fast food
        var address = $j("#address").val();
        var name = $j("#name").val();
        var telephone = $j("#telephone").val();
        var checkcode = $j("#checkcode").val();
        var attrVal = [address, name, telephone];
        var attrMsg = ["请输入配送地址", "请输入联系人姓名", "请输入联系电话"];
        var chkValid = $j("#validationCodeLi").attr("chkValid");//是否需要校验验证码
        if (chkValid == "1") {
            attrVal.push(checkcode);
            attrMsg.push("请输入验证码");
        }

        var len = attrVal.length;
        var index = 0;
        var isNullInput = false;
        for (; index < len; index++) {
            if (!attrVal[index]) {
                isNullInput = true;
                break;
            }
        }
        if (isNullInput) {
            alert(attrMsg[index]);
            return;
        }


        var fastFoodData = {
            "address": address,
            "name": name,
            "telephone": telephone,
            "checkcode": checkcode
        }

        mask();
        $j("#btnCheckout").hide();	//隐藏按钮
        $j("#btnContinue").hide();
        //$j(".btn_my").hide();
        $j("#goSalesOrder").hide();
        $j("#goback").hide();
        $j("#sendOrder").hide();
        $j(".loading").show();

        DWREngine.setAsync(false);
        checkoutDwr.saveFastFoodData(fastFoodData);
    }

    checkoutDwr.placeOrder(

            function (jsonText) {
                var result = eval('(' + jsonText + ')');
                if (result.error != null) {
                    alert(result.error);
                    //data.error = result.error;
                } else {
                    //window.location = __ctxPath + "/cart/orderReview.html?doAction=checkoutSucc&orderNo="+result.orderNo;
                    if (ms_syouType == "2" && ms_isVip != "1") {
                        window.location = __ctxPath + "/order/myOrder.html?type=2";
                    } else if (ms_syouType == "3") {
                        window.location = __ctxPath + "/order/myOrder.html";
                    } else if (ms_syouType == "2" && ms_isVip == "1") {
                        window.location = __ctxPath + "/order/myOrder.html?type=vip";
                    } else {
                        window.location = __ctxPath + "/order/myOrder.html";
                    }

                }
                unmask();
            }
    );

}

//删除商品项
function deleteItem(productSkuCode, obj) {
    //if(confirm("你确定要删除吗？")){
    showWaitMessage("loading", obj);
    delProductItem(productSkuCode, function () {
        $j(obj).parents("li:first").remove();
        refreshBill();

        var len = $j('span[name="quantitys"]').length;
        if (len <= 0) {
            //window.location.href='/m/cart/shoppingcart.html';
            $j("#btnCheckout").hide();
            $j(".appoint").hide();
        }
    });
    //}
}

//购买数量减1
function quantityMinus(productSkuCode, tabindex) {
    var filter = "span[name=quantitys][tabindex=" + tabindex + "]";
    var quantityElement = $j(filter);
    var quantity = 1;
    if (quantityElement.text() != "" && parseInt(quantityElement.text()) > 1) {
        quantity = parseInt(quantityElement.text()) - 1;
        quantityElement.text(quantity);
        quantityOnChange(productSkuCode, quantity);
    } else {
        deleteItem(productSkuCode, quantityElement);
    }
}

//购买数量加1
function quantityPlus(productSkuCode, tabindex) {
    var filter = "span[name=quantitys][tabindex=" + tabindex + "]";
    var quantityElement = $j(filter);
    var quantity = 1;
    if (quantityElement.text() != "")
        quantity = parseInt(quantityElement.text()) + 1;
    quantityElement.text(quantity);
    quantityOnChange(productSkuCode, quantity);
}

//更新商品项数量输入框触发事件
function quantityOnChange(productSkuCode, quantity) {
    changeQuantity(productSkuCode, quantity, afterQuantityChanged);		//定义在cart.js
}


//清空购物车
function clearCart() {
    if (confirm("你确定要清空吗？")) {
        clearShoppingcart(deleteCartCallback);
    }
}
//刷新购物车帐单信息
function refreshBill() {
    $j("#shippingcartBillDiv").load("/m/cart/shoppingcart.html?doAction=refreshBill&decorator=blank");
    //refreshPromo();
}

//刷新购物车促销信息
function refreshPromo() {
    $j("#shippingcartPromoDiv").load("/m/cart/shoppingcart.html?doAction=refreshPromo&decorator=blank");
}

//刷新商品项信息
function refreshItems() {
    $j("#shoppingcartItemsDiv").load("/m/cart/shoppingcart.html?doAction=refreshItems&decorator=blank");
    refreshPromo();
}

//商品加入购物车后的回调函数
function addToCartCallback(json, sourceEvent) {
    alert("商品已成功添加到购物车");
    refreshItems();
    refreshBill();
}

//商品添加到收藏夹后的回调函数
function addFavoriteProductCallback(json, sourceEvent) {
    promptFavoriteMessage(json, sourceEvent);
    $j("#rpBox2").load("/m/cart/shoppingcart.html?doAction=refreshShoppingcartFavorite&decorator=blank");

}
//删除收藏夹商品的回调函数
function deleteFavoriteCallback() {
    if ($j('#favoriteListDiv li').length == 0) {
        html = '<div class="msg">???shoppingcart.favorite.noItems???</div>';
        $j("#rpBox2").html(html);
    }


}
//清空商品的回调函数
function deleteCartCallback() {
    window.location = '/m/cart/shoppingcart.html';
}

//显示等待信息，例如“正在读取XXX信息，请稍等”
showWaitMessage = function (info, obj) {
    try {
        if (obj == null) return;
        clearWaitMessage();
        $j(obj).hide();
        $j("<i class='loading'>" + info + "</i>").insertAfter(obj);
    } catch (e) {
        alert(e);
    }
}

//清除等待信息
clearWaitMessage = function (obj) {
    try {
        $j(".loading").remove();
        if (obj != null) $j(obj).show();
    } catch (e) {
        alert(e);
    }
}

//具体促销显示
function getPromoValue(event) {
    $importDwr(function () {
        shoppingcartDwr.getPromoValue(function (jsonText) {
            var str = "";
            var json = eval("(" + jsonText + ")");
            for (var i = 0; i < json.length; i++) {
                str += "<li>" + json[i].messages1 + "</li>";
            }
            ;
            $j("#proms").html(str);
        })
    })
}

//判断输入是否是数字
isNumber = function (e) {
    if ($j.browser.msie) {
        if (((event.keyCode > 47) && (event.keyCode < 58)) || (event.keyCode == 8)) {
            return true;
        } else {
            return false;
        }
    } else {
        if (((e.which > 47) && (e.which < 58)) || (e.which == 8)) {
            return true;
        } else {
            return false;
        }
    }
}

function customerBindPanel_close() {
    dlgcustomerBindPanel_close();
    toCheckout();
}

function customerBindPanelCallback() {

}

function goSalesOrder() {
    window.location = "/m/order/salesOrder.html";
}

function goIndex() {
    window.location = "/m/index.html?isSelClientAccount=N";
}
</script>
</div>
</body>
</html>